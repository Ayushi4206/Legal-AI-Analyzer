<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Legal Document Analyzer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .risk-low { background: linear-gradient(45deg, #10b981, #34d399); }
        .risk-medium { background: linear-gradient(45deg, #f59e0b, #fbbf24); }
        .risk-high { background: linear-gradient(45deg, #ef4444, #f87171); }
        
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(102, 126, 234, 0.5); }
            50% { box-shadow: 0 0 40px rgba(102, 126, 234, 0.8); }
        }
        .animate-pulse-glow {
            animation: pulse-glow 2s ease-in-out infinite;
        }
    </style>
</head>
<body class="min-h-screen gradient-bg text-white">
    <!-- Navigation -->
    <nav class="glass-effect p-4 mb-8">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold">‚öñÔ∏è LegalAI Analyzer</h1>
            <div class="space-x-4">
                <button onclick="showTab('upload')" class="px-4 py-2 rounded-lg hover:bg-white hover:bg-opacity-20 transition-all">Upload</button>
                <button onclick="showTab('analyze')" class="px-4 py-2 rounded-lg hover:bg-white hover:bg-opacity-20 transition-all">Analyze</button>
                <button onclick="showTab('compare')" class="px-4 py-2 rounded-lg hover:bg-white hover:bg-opacity-20 transition-all">Compare</button>
                <button onclick="showTab('qa')" class="px-4 py-2 rounded-lg hover:bg-white hover:bg-opacity-20 transition-all">Q&A</button>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container mx-auto px-4">
        
        <!-- Upload Tab -->
        <div id="upload-tab" class="tab-content">
            <div class="glass-effect rounded-2xl p-8 mb-8 animate-pulse-glow">
                <h2 class="text-3xl font-bold mb-6 text-center">üìÑ Upload Legal Documents</h2>
                
                <div class="grid md:grid-cols-2 gap-8">
                    <!-- File Upload Area -->
                    <div class="space-y-6">
                        <div class="border-2 border-dashed border-white border-opacity-30 rounded-xl p-8 text-center hover:border-opacity-50 transition-all">
                            <input type="file" id="fileInput" multiple accept=".pdf,.docx,.doc" class="hidden">
                            <div onclick="document.getElementById('fileInput').click()" class="cursor-pointer">
                                <div class="text-4xl mb-4">üìÅ</div>
                                <p class="text-lg mb-2">Drop files here or click to browse</p>
                                <p class="text-sm opacity-70">Supports PDF, DOCX, DOC files</p>
                            </div>
                        </div>
                        
                        <button onclick="uploadFiles()" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg transition-all transform hover:scale-105">
                            üöÄ Upload & Process
                        </button>
                    </div>
                    
                    <!-- Upload Status -->
                    <div class="space-y-4">
                        <h3 class="text-xl font-semibold">üìä Upload Status</h3>
                        <div id="uploadStatus" class="space-y-2">
                            <div class="text-sm opacity-70">No files selected</div>
                        </div>
                        
                        <div id="processingProgress" class="hidden">
                            <div class="bg-white bg-opacity-20 rounded-full h-3">
                                <div id="progressBar" class="bg-blue-500 h-3 rounded-full transition-all duration-300" style="width: 0%"></div>
                            </div>
                            <p class="text-sm mt-2">Processing documents...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analyze Tab -->
        <div id="analyze-tab" class="tab-content hidden">
            <div class="space-y-8">
                <!-- Document Summary -->
                <div class="glass-effect rounded-2xl p-6">
                    <h2 class="text-2xl font-bold mb-4">üìã Document Summary</h2>
                    <div id="documentSummary" class="grid md:grid-cols-3 gap-4">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Risk Heatmap -->
                <div class="glass-effect rounded-2xl p-6">
                    <h2 class="text-2xl font-bold mb-4">üéØ Risk Heatmap</h2>
                    <div id="riskHeatmap" class="space-y-4">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Clause Analysis -->
                <div class="glass-effect rounded-2xl p-6">
                    <h2 class="text-2xl font-bold mb-4">üîç Clause Analysis</h2>
                    <div id="clauseAnalysis" class="space-y-6">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Entity Extraction -->
                <div class="glass-effect rounded-2xl p-6">
                    <h2 class="text-2xl font-bold mb-4">üè¢ Key Entities</h2>
                    <div id="entityExtraction" class="grid md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Compare Tab -->
        <div id="compare-tab" class="tab-content hidden">
            <div class="glass-effect rounded-2xl p-6">
                <h2 class="text-2xl font-bold mb-4">‚öñÔ∏è Document Comparison</h2>
                
                <div class="grid md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <label class="block text-sm font-medium mb-2">Document 1</label>
                        <select id="compareDoc1" class="w-full p-3 rounded-lg bg-white bg-opacity-20 border border-white border-opacity-30">
                            <option value="">Select document...</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Document 2</label>
                        <select id="compareDoc2" class="w-full p-3 rounded-lg bg-white bg-opacity-20 border border-white border-opacity-30">
                            <option value="">Select document...</option>
                        </select>
                    </div>
                </div>
                
                <button onclick="compareDocuments()" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-6 rounded-lg transition-all">
                    üîÑ Compare Documents
                </button>
                
                <div id="comparisonResults" class="mt-6 space-y-4">
                    <!-- Comparison results will appear here -->
                </div>
            </div>
        </div>

        <!-- Q&A Tab -->
        <div id="qa-tab" class="tab-content hidden">
            <div class="glass-effect rounded-2xl p-6">
                <h2 class="text-2xl font-bold mb-4">üí¨ Ask Questions About Your Documents</h2>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Select Document</label>
                    <select id="qaDocument" class="w-full p-3 rounded-lg bg-white bg-opacity-20 border border-white border-opacity-30">
                        <option value="">Select document for Q&A...</option>
                    </select>
                </div>
                
                <div class="flex gap-4 mb-6">
                    <input type="text" id="questionInput" placeholder="Ask a question about your document..." 
                           class="flex-1 p-3 rounded-lg bg-white bg-opacity-20 border border-white border-opacity-30 placeholder-white placeholder-opacity-70">
                    <button onclick="askQuestion()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg transition-all">
                        ‚ùì Ask
                    </button>
                </div>
                
                <div class="flex flex-wrap gap-2 mb-6">
                    <button onclick="askPredefined('Can I terminate this contract early?')" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-full text-sm">
                        Early termination?
                    </button>
                    <button onclick="askPredefined('What are the penalties for breach?')" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-full text-sm">
                        Breach penalties?
                    </button>
                    <button onclick="askPredefined('What are my obligations?')" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-full text-sm">
                        My obligations?
                    </button>
                    <button onclick="askPredefined('What are the payment terms?')" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-full text-sm">
                        Payment terms?
                    </button>
                </div>
                
                <div id="qaResults" class="space-y-4">
                    <!-- Q&A results will appear here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let uploadedDocuments = [];
        let currentAnalysis = null;
        
        // API Configuration
        const API_BASE_URL = 'http://localhost:8000'; // Update this with your backend URL
        
        // Tab Management
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            document.getElementById(tabName + '-tab').classList.remove('hidden');
        }
        
        // File Upload
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const files = Array.from(e.target.files);
            updateUploadStatus(files);
        });
        
        function updateUploadStatus(files) {
            const statusDiv = document.getElementById('uploadStatus');
            if (files.length === 0) {
                statusDiv.innerHTML = '<div class="text-sm opacity-70">No files selected</div>';
                return;
            }
            
            statusDiv.innerHTML = files.map(file => 
                `<div class="flex justify-between items-center bg-white bg-opacity-10 p-3 rounded-lg">
                    <span class="text-sm">${file.name}</span>
                    <span class="text-xs opacity-70">${(file.size / 1024 / 1024).toFixed(2)} MB</span>
                </div>`
            ).join('');
        }
        
        async function uploadFiles() {
            const fileInput = document.getElementById('fileInput');
            const files = fileInput.files;
            
            if (files.length === 0) {
                alert('Please select files to upload');
                return;
            }
            
            const progressDiv = document.getElementById('processingProgress');
            const progressBar = document.getElementById('progressBar');
            
            progressDiv.classList.remove('hidden');
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const formData = new FormData();
                formData.append('file', file);
                
                try {
                    // Simulate progress
                    progressBar.style.width = `${((i + 1) / files.length) * 100}%`;
                    
                    const response = await fetch(`${API_BASE_URL}/upload`, {
                        method: 'POST',
                        body: formData
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        uploadedDocuments.push({
                            id: result.document_id,
                            name: file.name,
                            analysis: result.analysis
                        });
                        
                        updateDocumentSelectors();
                    }
                } catch (error) {
                    console.error('Upload error:', error);
                    // For demo purposes, create mock data
                    uploadedDocuments.push({
                        id: Date.now() + i,
                        name: file.name,
                        analysis: generateMockAnalysis(file.name)
                    });
                }
            }
            
            updateDocumentSelectors();
            showAnalysisResults();
            
            setTimeout(() => {
                progressDiv.classList.add('hidden');
                progressBar.style.width = '0%';
                showTab('analyze');
            }, 1000);
        }
        
        function generateMockAnalysis(fileName) {
            const mockClauses = [
                {
                    title: "Termination Clause",
                    content: "Either party may terminate this agreement with 30 days written notice.",
                    simplified: "You can end this contract by giving 30 days notice in writing.",
                    risk_level: "low",
                    risk_score: 2
                },
                {
                    title: "Liability Limitation",
                    content: "In no event shall the company be liable for any indirect, incidental, special, or consequential damages.",
                    simplified: "The company won't pay for indirect damages if something goes wrong.",
                    risk_level: "high",
                    risk_score: 8
                },
                {
                    title: "Payment Terms",
                    content: "Payment shall be due within 30 days of invoice date. Late payments subject to 1.5% monthly interest.",
                    simplified: "Pay within 30 days or face 1.5% monthly late fees.",
                    risk_level: "medium",
                    risk_score: 5
                },
                {
                    title: "Confidentiality",
                    content: "All information exchanged shall remain confidential for a period of 5 years.",
                    simplified: "Keep all shared information secret for 5 years.",
                    risk_level: "low",
                    risk_score: 3
                }
            ];
            
            return {
                summary: `Analysis of ${fileName}`,
                clauses: mockClauses,
                entities: {
                    parties: ["Company ABC", "John Doe"],
                    dates: ["2025-01-15", "2025-12-31"],
                    obligations: ["Monthly payment", "Confidentiality maintenance"],
                    penalties: ["1.5% monthly interest", "Contract termination"]
                },
                overall_risk: "medium"
            };
        }
        
        function updateDocumentSelectors() {
            const selectors = ['compareDoc1', 'compareDoc2', 'qaDocument'];
            selectors.forEach(selectorId => {
                const selector = document.getElementById(selectorId);
                selector.innerHTML = '<option value="">Select document...</option>';
                uploadedDocuments.forEach(doc => {
                    selector.innerHTML += `<option value="${doc.id}">${doc.name}</option>`;
                });
            });
        }
        
        function showAnalysisResults() {
            if (uploadedDocuments.length === 0) return;
            
            const latestDoc = uploadedDocuments[uploadedDocuments.length - 1];
            currentAnalysis = latestDoc.analysis;
            
            // Update document summary
            updateDocumentSummary();
            
            // Update risk heatmap
            updateRiskHeatmap();
            
            // Update clause analysis
            updateClauseAnalysis();
            
            // Update entity extraction
            updateEntityExtraction();
        }
        
        function updateDocumentSummary() {
            const summaryDiv = document.getElementById('documentSummary');
            const totalClauses = currentAnalysis.clauses.length;
            const highRisk = currentAnalysis.clauses.filter(c => c.risk_level === 'high').length;
            const avgRisk = currentAnalysis.clauses.reduce((sum, c) => sum + c.risk_score, 0) / totalClauses;
            
            summaryDiv.innerHTML = `
                <div class="bg-blue-500 bg-opacity-30 p-4 rounded-lg text-center">
                    <div class="text-2xl font-bold">${totalClauses}</div>
                    <div class="text-sm opacity-80">Total Clauses</div>
                </div>
                <div class="bg-red-500 bg-opacity-30 p-4 rounded-lg text-center">
                    <div class="text-2xl font-bold">${highRisk}</div>
                    <div class="text-sm opacity-80">High Risk</div>
                </div>
                <div class="bg-yellow-500 bg-opacity-30 p-4 rounded-lg text-center">
                    <div class="text-2xl font-bold">${avgRisk.toFixed(1)}</div>
                    <div class="text-sm opacity-80">Avg Risk Score</div>
                </div>
            `;
        }
        
        function updateRiskHeatmap() {
            const heatmapDiv = document.getElementById('riskHeatmap');
            heatmapDiv.innerHTML = currentAnalysis.clauses.map(clause => {
                const riskClass = `risk-${clause.risk_level}`;
                return `
                    <div class="flex items-center justify-between p-4 rounded-lg ${riskClass} text-white">
                        <div class="flex-1">
                            <h4 class="font-semibold">${clause.title}</h4>
                            <p class="text-sm opacity-90">${clause.simplified}</p>
                        </div>
                        <div class="text-right">
                            <div class="text-2xl font-bold">${clause.risk_score}/10</div>
                            <div class="text-xs uppercase">${clause.risk_level} Risk</div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function updateClauseAnalysis() {
            const analysisDiv = document.getElementById('clauseAnalysis');
            analysisDiv.innerHTML = currentAnalysis.clauses.map(clause => `
                <div class="bg-white bg-opacity-10 p-6 rounded-lg">
                    <h4 class="text-lg font-semibold mb-2">${clause.title}</h4>
                    <div class="mb-3">
                        <h5 class="text-sm font-medium mb-1 opacity-80">Original Text:</h5>
                        <p class="text-sm bg-black bg-opacity-20 p-3 rounded italic">"${clause.content}"</p>
                    </div>
                    <div>
                        <h5 class="text-sm font-medium mb-1 opacity-80">Plain English:</h5>
                        <p class="text-green-300">${clause.simplified}</p>
                    </div>
                </div>
            `).join('');
        }
        
        function updateEntityExtraction() {
            const entityDiv = document.getElementById('entityExtraction');
            const entities = currentAnalysis.entities;
            
            entityDiv.innerHTML = `
                <div class="bg-white bg-opacity-10 p-4 rounded-lg">
                    <h4 class="font-semibold mb-2">üè¢ Parties</h4>
                    ${entities.parties.map(party => `<span class="inline-block bg-blue-500 px-2 py-1 rounded text-xs mr-2 mb-1">${party}</span>`).join('')}
                </div>
                <div class="bg-white bg-opacity-10 p-4 rounded-lg">
                    <h4 class="font-semibold mb-2">üìÖ Important Dates</h4>
                    ${entities.dates.map(date => `<span class="inline-block bg-green-500 px-2 py-1 rounded text-xs mr-2 mb-1">${date}</span>`).join('')}
                </div>
                <div class="bg-white bg-opacity-10 p-4 rounded-lg">
                    <h4 class="font-semibold mb-2">‚úÖ Obligations</h4>
                    ${entities.obligations.map(obligation => `<span class="inline-block bg-yellow-500 px-2 py-1 rounded text-xs mr-2 mb-1">${obligation}</span>`).join('')}
                </div>
                <div class="bg-white bg-opacity-10 p-4 rounded-lg">
                    <h4 class="font-semibold mb-2">‚ö†Ô∏è Penalties</h4>
                    ${entities.penalties.map(penalty => `<span class="inline-block bg-red-500 px-2 py-1 rounded text-xs mr-2 mb-1">${penalty}</span>`).join('')}
                </div>
            `;
        }
        
        // Document Comparison
        async function compareDocuments() {
            const doc1Id = document.getElementById('compareDoc1').value;
            const doc2Id = document.getElementById('compareDoc2').value;
            
            if (!doc1Id || !doc2Id) {
                alert('Please select both documents to compare');
                return;
            }
            
            if (doc1Id === doc2Id) {
                alert('Please select different documents');
                return;
            }
            
            const doc1 = uploadedDocuments.find(d => d.id == doc1Id);
            const doc2 = uploadedDocuments.find(d => d.id == doc2Id);
            
            const resultsDiv = document.getElementById('comparisonResults');
            resultsDiv.innerHTML = `
                <div class="bg-white bg-opacity-10 p-6 rounded-lg">
                    <h4 class="text-lg font-semibold mb-4">üìä Comparison Results</h4>
                    
                    <div class="grid md:grid-cols-2 gap-4 mb-6">
                        <div class="text-center">
                            <h5 class="font-semibold">${doc1.name}</h5>
                            <div class="text-2xl">${doc1.analysis.clauses.length}</div>
                            <div class="text-sm opacity-80">Clauses</div>
                        </div>
                        <div class="text-center">
                            <h5 class="font-semibold">${doc2.name}</h5>
                            <div class="text-2xl">${doc2.analysis.clauses.length}</div>
                            <div class="text-sm opacity-80">Clauses</div>
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        <h5 class="font-semibold">Key Differences:</h5>
                        <div class="bg-yellow-500 bg-opacity-20 p-3 rounded">
                            <strong>Risk Level:</strong> ${doc1.name} (${doc1.analysis.overall_risk}) vs ${doc2.name} (${doc2.analysis.overall_risk})
                        </div>
                        <div class="bg-blue-500 bg-opacity-20 p-3 rounded">
                            <strong>Unique Clauses:</strong> Each document contains different termination and liability terms
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Q&A Functionality
        function askPredefined(question) {
            document.getElementById('questionInput').value = question;
            askQuestion();
        }
        
        async function askQuestion() {
            const docId = document.getElementById('qaDocument').value;
            const question = document.getElementById('questionInput').value;
            
            if (!docId) {
                alert('Please select a document first');
                return;
            }
            
            if (!question.trim()) {
                alert('Please enter a question');
                return;
            }
            
            const resultsDiv = document.getElementById('qaResults');
            
            // Add user question
            const questionDiv = document.createElement('div');
            questionDiv.className = 'bg-blue-500 bg-opacity-30 p-4 rounded-lg ml-8';
            questionDiv.innerHTML = `<strong>You:</strong> ${question}`;
            resultsDiv.appendChild(questionDiv);
            
            // Simulate AI response
            setTimeout(() => {
                const answerDiv = document.createElement('div');
                answerDiv.className = 'bg-green-500 bg-opacity-30 p-4 rounded-lg mr-8';
                answerDiv.innerHTML = `<strong>AI:</strong> ${generateMockAnswer(question)}`;
                resultsDiv.appendChild(answerDiv);
                
                // Clear input
                document.getElementById('questionInput').value = '';
            }, 1000);
        }
        
        function generateMockAnswer(question) {
            const answers = {
                'Can I terminate this contract early?': 'Yes, according to the termination clause, either party can terminate this agreement with 30 days written notice.',
                'What are the penalties for breach?': 'The contract specifies a 1.5% monthly interest rate for late payments and potential contract termination for material breaches.',
                'What are my obligations?': 'Your main obligations include making monthly payments on time and maintaining confidentiality of shared information for 5 years.',
                'What are the payment terms?': 'Payment is due within 30 days of the invoice date. Late payments are subject to 1.5% monthly interest charges.'
            };
            
            return answers[question] || 'Based on the document analysis, I can see several relevant clauses. The specific answer depends on the context of your question. Could you be more specific about which aspect you\'re interested in?';
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            showTab('upload');
        });
    </script>
</body>
</html>